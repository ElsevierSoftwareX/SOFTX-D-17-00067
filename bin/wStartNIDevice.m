function studyInfo=wStartNIDevice(studyInfo)
%   function studyInfo=wStartNIDevice(studyInfo)
%
%   This funtion generates the startNIDevice script for study experiments
%   created with the AudExpCreator.
%
% (c) Duc T. Nguyen and Blair Kaneshiro, 2017
% Distributed under Creative Commons Zero (CC0) license
% Contact: audexpcreator@gmail.com

line{1}='function s = startNIDevice';
line{2}=sprintf('%% %s', line{1});
line{3}='% This function initiates the NI Device as the "s" object and so whenever the';
line{4}='% "s" object is called it is the script acting on the NI Device.';
dLines=4;
line{dLines+1}='%';
line{dLines+2}='% This script was generated by AudExpCreator.';
line{dLines+3}='% (c) Duc T. Nguyen and Blair Kaneshiro, 2017';
line{dLines+4}='% Distributed under Creative Commons Zero (CC0) license';
line{dLines+5}='% Contact: audexpcreator@gmail.com';
dOS=5;

line{dOS+6}='try';
line{dOS+7}='d = daq.getDevices();';
line{dOS+8}='dev=get(d(1));';

line{dOS+10}='s = daq.createSession(''ni'');';
line{dOS+11}='addDigitalChannel(s,dev.ID,''port0/line0:7'',''OutputOnly'');';
line{dOS+12}='addDigitalChannel(s,dev.ID,''port1/line0:3'',''OutputOnly'');';

line{dOS+13}='catch';
line{dOS+14}='error(''NI Device not connect. Experiment will now error out. Goodbye.'');';
line{dOS+15}='end';
tabLine = [dOS+7:dOS+12 dOS+14];

studyInfo.fLine.sNID = line{1}(10:end);

fName = 'startNIDevice';
fID = fopen([studyInfo.path filesep fName '.m'],'w');
for i=1:length(line)
    if any(ismember(i,tabLine))
        fprintf(fID,'\t%s\n',line{i});
    else
        fprintf(fID,'%s\n',line{i});
    end
end
fclose(fID);