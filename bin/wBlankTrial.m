function studyInfo=wBlankTrial(studyInfo,blankStruct)
%   function studyInfo=wBlankTrial(studyInfo,blankStruct)
%
%   This funtion generates the blankTrial script for study experiments
%   created with the AudExpCreator.
%
% (c) Duc T. Nguyen and Blair Kaneshiro, 2017
% Distributed under Creative Commons Zero (CC0) license
% Contact: audexpcreator@gmail.com

if strcmp(studyInfo.type,'Neurophysiological Study') || strcmp(studyInfo.type,'EEG Study')
    if strcmp(blankStruct.type,'image')
        line{1}='function blankTrial(wPtr, wRect, bgColor, imdata, duration)';
    else
        line{1}='function blankTrial(wPtr, wRect, bgColor, fontColor, duration)';
    end
else
    line{1}='function blankTrial(wPtr, bgColor, fontColor, duration)';
end

line{2}=sprintf('%% %s', line{1});
line{3}='% This function displays a blank, black screen or the stim screen on the';
line{4}='% screen. There is no exit key or force quit key to this screen as it is set';
line{5}='% to a timer to automatically exit.';
line{6}='%';
line{7}='% This script was generated by AudExpCreator.';
line{8}='% (c) Duc T. Nguyen and Blair Kaneshiro, 2017';
line{9}='% Distributed under Creative Commons Zero (CC0) license';
line{10}='% Contact: audexpcreator@gmail.com';
subL=11;

if strcmp(studyInfo.type,'Neurophysiological Study') || strcmp(studyInfo.type,'EEG Study')
    if strcmp(blankStruct.type,'cross') ||strcmp(blankStruct.type,'dot')
        line{subL+1}='[xC, yC] = RectCenter(wRect);';
        subL=subL+2;
    end
end

line{subL+1}='Screen(''FillRect'',wPtr,bgColor);';
subL=subL+1;

if strcmp(studyInfo.type,'Neurophysiological Study') || strcmp(studyInfo.type,'EEG Study')
    if strcmp(blankStruct.type,'image')
        line{subL+1}='imagetex=Screen(''MakeTexture'', wPtr, imdata);';
        line{subL+2}='tRect=Screen(''Rect'', imagetex);';
        line{subL+3}='CenterRect(tRect, wRect);';
        line{subL+4}='Screen(''DrawTexture'',wPtr,imagetex);';
        subL=subL+4;
        
    elseif strcmp(blankStruct.type,'cross')
        line{subL+1}='Screen(''DrawLine'',wPtr,fontColor, xC-30, yC, xC+30, yC, 2);';
        line{subL+2}='Screen(''DrawLine'',wPtr,fontColor, xC, yC-30, xC, yC+30, 2);';
        subL=subL+2;
        
    elseif strcmp(blankStruct.type,'dot')
        line{subL+1}='Screen(''FillOval'', wPtr, fontColor, [xC-25 yC-25 xC+25 yC+25]);';
        subL=subL+1;
        
    end
else
    line{subL+1}='Screen(''TextSize'', wPtr, 45);';
    line{subL+2}=sprintf('mytext = ''%s'';',blankStruct.text);
    line{subL+3}='[~, ~, ~] = DrawFormattedText(wPtr, mytext, ''center'', ''center'', fontColor);';
    subL=subL+3;
end

line{subL+1}='Screen(wPtr, ''Flip'');';
line{subL+2}='HideCursor;';
subL=subL+3;

line{subL+1}='tic;';
line{subL+2}='while toc < duration';
line{subL+3}='end';

studyInfo.fLine.blTrial = line{1}(10:end);

fName = 'blankTrial';
fID = fopen([studyInfo.path filesep fName '.m'],'w');
for i=1:length(line)
    fprintf(fID,'%s\n',line{i});
end
fclose(fID);


