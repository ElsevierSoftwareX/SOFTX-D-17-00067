function studyInfo = wMy_callback_fcn1(studyInfo)
%   function studyInfo = wMy_callback_fcn1(studyInfo)
%
%   This funtion generates the my_callback_fcn1 script for study 
%   experiments created with the AudExpCreator.
%
% (c) Duc T. Nguyen and Blair Kaneshiro, 2017
% Distributed under Creative Commons Zero (CC0) license
% Contact: audexpcreator@gmail.com

tabLine=[];

if strcmp(studyInfo.signalType,'TTL')
    line{1}='function my_callback_fcn1(obj, event, s, trigger)';
    
    line{3}='% This function is part of the timer object that operates on the s object to';
    line{4}='% try to simultaneously start playing the stim while also sending out the';
    line{5}='% trigger. This function works on sending out the trigger. However there is';
    line{6}='% a delay nevertheless. So please use embedded clicks for better timing.';
    dLines=6;
    line{dLines+1}='%';
    line{dLines+2}='% This script was generated by AudExpCreator.';
    line{dLines+3}='% (c) Duc T. Nguyen and Blair Kaneshiro, 2017';
    line{dLines+4}='% Distributed under Creative Commons Zero (CC0) license';
    line{dLines+5}='% Contact: audexpcreator@gmail.com';
    dOS=5;

    line{dOS+8}='s.outputSingleScan(de2bi(trigger,12));';
    line{dOS+9}='s.outputSingleScan(de2bi(0,12));';
elseif strcmp(studyInfo.signalType,'TCP/IP')
    line{1}='function my_callback_fcn1(obj, event, trigger)';
    
    line{3}='% This function is part of the timer object. This function works on sending';
    line{4}='% out the trigger. However there might be a delay nevertheless. So please use';
    line{5}='% embedded clicks for better timing.';
    dLines=5;
    line{dLines+1}='%';
    line{dLines+2}='% This script was generated by AudExpCreator.';
    line{dLines+3}='% (c) Duc T. Nguyen and Blair Kaneshiro, 2017';
    line{dLines+4}='% Distributed under Creative Commons Zero (CC0) license';
    line{dLines+5}='% Contact: audexpcreator@gmail.com';
    dOS=5;
    
    line{dOS+7}='trig=sprintf(''%04d'',trigger);';
    line{dOS+8}='[status, erMS] = NetStation(''Event'',trig);';
    line{dOS+9}='if status~=0';
    line{dOS+10}='display([erMS ''. Goodbye.''])';
    line{dOS+11}='error(''Failure in sending event to NetStation.'');';
    line{dOS+12}='end';
    
    tabLine=dOS+10:dOS+11;
end

line{2}=sprintf('%% %s', line{1});

studyInfo.fLine.mcfcn1 = line{1}(10:end);

fName = 'my_callback_fcn1';
fID = fopen([studyInfo.path filesep fName '.m'],'w');
for i=1:length(line)
    if any(ismember(i,tabLine))
        fprintf(fID,'\t%s\n',line{i});
    else
        fprintf(fID,'%s\n',line{i});
    end
end
fclose(fID);


