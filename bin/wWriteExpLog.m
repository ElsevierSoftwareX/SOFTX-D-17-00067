function studyInfo=wWriteExpLog(studyInfo)
%   function studyInfo=wWriteExpLog(studyInfo)
%
%   This funtion generates the writeExpLog script for study experiments
%   created with the AudExpCreator.
%
% (c) Duc T. Nguyen and Blair Kaneshiro, 2017
% Distributed under Creative Commons Zero (CC0) license
% Contact: audexpcreator@gmail.com

line{3}='% This function writes out an experimental log witht the stimulus ordering for';
line{4}='% that subject during the run of the session.';
dLines=4;
line{dLines+1}='%';
line{dLines+2}='% This script was generated by AudExpCreator.';
line{dLines+3}='% (c) Duc T. Nguyen and Blair Kaneshiro, 2017';
line{dLines+4}='% Distributed under Creative Commons Zero (CC0) license';
line{dLines+5}='% Contact: audexpcreator@gmail.com';
dOS=5;

if strcmp(studyInfo.type,'Behavioral Rating Study')
    if studyInfo.presNum>1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichPres, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_R%%02d_%%d_BR.txt'', subject, whichPres, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d\r\n   Recording: %d\r\n'', subject, todayDate, whichPres, whichRec);';
    elseif studyInfo.presNum>1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, whichPres, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_%%d_BR.txt'', subject, whichPres, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d\r\n'', subject, todayDate, whichPres);';
    elseif studyInfo.presNum==1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_R%%02d_%%d_BR.txt'', subject, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Recording: %d\r\n'', subject, todayDate, whichRec);';
    elseif studyInfo.presNum==1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_%%d_BR.txt'', subject, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d\r\n'', subject, todayDate);';
    end
elseif strcmp(studyInfo.type,'Comparison Behav. Rating Study');
    if studyInfo.presNum>1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichPres, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_R%%02d_%%d_CompS.txt'', subject, whichPres, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d   Recording: %d\r\n'', subject, todayDate, whichPres, whichRec);';
    elseif studyInfo.presNum>1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, whichPres, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_%%d_CompS.txt'', subject, whichPres, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d\r\n'', subject, todayDate, whichPres);';
    elseif studyInfo.presNum==1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_R%%02d_%%d_CompS.txt'', subject, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Recording: %d\r\n'', subject, todayDate, whichRec);';
    elseif studyInfo.presNum==1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_%%d_CompS.txt'', subject, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d\r\n'', subject, todayDate);';
    end
elseif strcmp(studyInfo.type, 'Continuous Behav. Rating Study');
    if studyInfo.presNum>1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichPres, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_R%%02d_%%d_CBR.txt'', subject, whichPres, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d   Recording: %d\r\n'', subject, todayDate, whichPres, whichRec);';
    elseif studyInfo.presNum>1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, whichPres, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_%%d_CBR.txt'', subject, whichPres, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d\r\n'', subject, todayDate, whichPres);';
    elseif studyInfo.presNum==1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_R%%02d_%%d_CBR.txt'', subject, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Recording: %d\r\n'', subject, todayDate, whichRec);';
    elseif studyInfo.presNum==1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_%%d_CBR.txt'', subject, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d\r\n'', subject, todayDate);';
    end
elseif strcmp(studyInfo.type,'EEG Study')
    if studyInfo.presNum>1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichPres, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_R%%02d_%%d_ES.txt'', subject, whichPres, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d   Recording: %d\r\n'', subject, todayDate, whichPres, whichRec);';
    elseif studyInfo.presNum>1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, whichPres, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_%%d_ES.txt'', subject, whichPres, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d\r\n'', subject, todayDate, whichPres);';
    elseif studyInfo.presNum==1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_R%%02d_%%d_ES.txt'', subject, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Recording: %d\r\n'', subject, todayDate, whichRec);';
    elseif studyInfo.presNum==1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_%%d_ES.txt'', subject, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d\r\n'', subject, todayDate);';
    end
elseif strcmp(studyInfo.type,'Neurophysiological Study')
    if studyInfo.presNum>1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichPres, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_R%%02d_%%d_NS.txt'', subject, whichPres, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d   Recording: %d\r\n'', subject, todayDate, whichPres, whichRec);';
    elseif studyInfo.presNum>1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, whichPres, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_P%%02d_%%d_NS.txt'', subject, whichPres, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Presentation: %d\r\n'', subject, todayDate, whichPres);';
    elseif studyInfo.presNum==1 && studyInfo.recNum>1
        line{1}='function writeExpLog(todayDate, subject, whichRec, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_R%%02d_%%d_NS.txt'', subject, whichRec, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d  Recording: %d\r\n'', subject, todayDate, whichRec);';
    elseif studyInfo.presNum==1 && studyInfo.recNum==1
        line{1}='function writeExpLog(todayDate, subject, trigger)';
        line{dOS+10}=sprintf('fileID = fopen([logFolder sprintf(''%s_S%%02d_%%d_NS.txt'', subject, todayDate)],''w'');', studyInfo.name);
        line{dOS+12}='fprintf(fileID, ''\nSubject: %02d  Date: %d\r\n'', subject, todayDate);';
    end
end


line{2}=sprintf('%% %s', line{1});

line{dOS+5}='folderPath=which(''writeExpLog'');';
line{dOS+6}='f=find(filesep==folderPath);';
line{dOS+7}='path=folderPath(1:f(end));';
line{dOS+8}='logFolder = [path ''log'' filesep];';

if strcmp(studyInfo.type,'Behavioral Rating Study')
    line{dOS+11}=sprintf('fprintf(fileID, ''Behavioral Rating Study: %s\\n'');',studyInfo.name); 
   
    s='';
    for k=1:studyInfo.stimInSet;
        s=[s '%d '];
    end
    d=sprintf('[%s]',s);
    s=sprintf('[%s]',s);
    for i=1:((studyInfo.stimPerRec/studyInfo.stimInSet)-1)
        s=[ s d];
    end
    
    line{dOS+13}=sprintf('fprintf(fileID, ''Stimulus Block = %s\\r'', trigger{:});',s);

elseif strcmp(studyInfo.type,'Comparison Behav. Rating Study');
    line{dOS+11}=sprintf('fprintf(fileID, ''Comparison Behav. Rating Study: %s\\n'');',studyInfo.name); 
    
    s='%d ';
    for k=1:studyInfo.stimInSet-1;
        s=[s '%d '];
    end
    d=sprintf('[%s]',s);
    s=sprintf('[%s]',s);
    for i=1:((studyInfo.stimPerRec/2)-1)
        s=[s d];
    end
    
    t=', trigger{1,:}';
    for q=1:(studyInfo.stimPerRec/studyInfo.stimInSet)-1
        t=[t ' , trigger{' num2str(q+1) ',:}'];
    end
    
    line{dOS+13}=sprintf('fprintf(fileID, ''Stimulus Block = %s\\r''%s);',s,t);

elseif strcmp(studyInfo.type, 'Continuous Behav. Rating Study');
    line{dOS+11}=sprintf('fprintf(fileID, ''Continuous Behav. Rating Study: %s\\n'');',studyInfo.name); 
    
    s='%d ';
    for i=1:studyInfo.stimPerRec-1
        s=[s '%d '];
    end
    
    line{dOS+13}=sprintf('fprintf(fileID, ''Stimulus Block = [%s]\\r'', trigger{:});',s);


elseif strcmp(studyInfo.type,'EEG Study')
    line{dOS+11}=sprintf('fprintf(fileID, ''EEG Study: %s\\n'');',studyInfo.name); 
    
    s='';
    for k=1:studyInfo.stimInSet;
        s=[s '%d '];
    end
    d=sprintf('[%s]',s);
    s=sprintf('[%s]',s);
    for i=1:((studyInfo.stimPerRec/studyInfo.stimInSet)-1)
        s=[ s d];
    end
    
    line{dOS+13}=sprintf('fprintf(fileID, ''Stimulus Block = %s\\r'', trigger{:});',s);

elseif strcmp(studyInfo.type,'Neurophysiological Study')
    line{dOS+11}=sprintf('fprintf(fileID, ''Neurophysiological Study: %s\\n'');',studyInfo.name); 
    
    s='%d ';
    for k=1:studyInfo.bLSettings;
        s=[s '%d '];
    end
    d=sprintf('[%s]',s);
    s=sprintf('[%s]',s);
    for i=1:((studyInfo.stimPerRec/studyInfo.bLSettings)-1)
        s=[s d];
    end
    
    t=', trigger{1,:}';
    for q=1:(studyInfo.stimPerRec/studyInfo.bLSettings)-1
        t=[t ' , trigger{' num2str(q+1) ',:}'];
    end
    
    line{dOS+13}=sprintf('fprintf(fileID, ''Stimulus Block = [%s]\\r''%s);',s,t);
end
line{dOS+14}='fclose(fileID);';

studyInfo.fLine.wExpLog = line{1}(10:end);

fName = 'writeExpLog';
fID = fopen([studyInfo.path filesep fName '.m'],'w');
for i=1:length(line)
    fprintf(fID,'%s\n',line{i});
end
fclose(fID);
