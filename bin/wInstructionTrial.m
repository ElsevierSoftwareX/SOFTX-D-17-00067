function studyInfo=wInstructionTrial(studyInfo,insSStruct)
%   function studyInfo=wInstructionTrial(studyInfo,insSStruct)
%
%   This funtion generates the instructionTrial script for study 
%   experiments created with the AudExpCreator.
%
% (c) Duc T. Nguyen and Blair Kaneshiro, 2017
% Distributed under Creative Commons Zero (CC0) license
% Contact: audexpcreator@gmail.com

line{1}=sprintf('function instructionTrial(wPtr,wRect,bgColor,fontColor,%s,trigIndex)', studyInfo.insStructName);
line{2}=sprintf('%% %s', line{1});
line{3}='% This function displays the instruction screen and texts to help prepare';
line{4}=sprintf('%% the subject to do the task. To exit this instruction screen press %s.',insSStruct.exitB);
dLines=4;
line{dLines+1}='%';
line{dLines+2}='% This script was generated by AudExpCreator.';
line{dLines+3}='% (c) Duc T. Nguyen and Blair Kaneshiro, 2017';
line{dLines+4}='% Distributed under Creative Commons Zero (CC0) license';
line{dLines+5}='% Contact: audexpcreator@gmail.com';
dOS=5;

line{dOS+6}='KbName(''UnifyKeyNames'');';
line{dOS+7}=sprintf('spaceBar = KbName(''%s'');',insSStruct.exitB);
line{dOS+8}=sprintf('escapeKey = KbName(''%s'');',studyInfo.fQuitKey);

line{dOS+10}='[~, yC] = RectCenter(wRect);';

line{dOS+12}='Screen(''FillRect'',wPtr,bgColor);';
line{dOS+13}='Screen(''TextSize'', wPtr, 26);';
line{dOS+14}='mytext01 = ''INSTRUCTIONS'';';
line{dOS+15}='[~, ~, ~] = DrawFormattedText(wPtr, mytext01, ''center'', yC-250, fontColor);';

line{dOS+16}='Screen(''TextSize'', wPtr, 18);';
line{dOS+17}='mytext02 = ''DEFINITION'';';
line{dOS+18}=sprintf('mytext03=%s(trigIndex).definition;', studyInfo.insStructName);
line{dOS+19}='mytext04 = ''YOUR TASK:'';';
line{dOS+20}=sprintf(['mytext05 = sprintf(''You will continuously rate your level',...
    ' of %%s with an excerpt as it plays.'',%s(trigIndex).task);'], studyInfo.insStructName);
line{dOS+21}='mytext06 = ''Press the space bar to continue.'';';
line{dOS+22}='[~, ~, ~] = DrawFormattedText(wPtr, mytext02, ''center'', yC-150, fontColor);';
line{dOS+23}='[~, ~, ~] = DrawFormattedText(wPtr, mytext03, ''center'', yC-115, fontColor,75);';
line{dOS+24}='[~, ~, ~] = DrawFormattedText(wPtr, mytext04, ''center'', yC-10, fontColor);';
line{dOS+25}='[~, ~, ~] = DrawFormattedText(wPtr, mytext05, ''center'', yC+25, fontColor);';
line{dOS+26}='[~, ~, ~] = DrawFormattedText(wPtr, mytext06, ''center'', yC+300, fontColor);';

line{dOS+28}='Screen(wPtr, ''Flip'');';
line{dOS+29}='HideCursor;';

line{dOS+31}='onBreak=true;';
line{dOS+32}='while onBreak';
line{dOS+33}='[~, keyCode, ~] = KbWait([], 2);';
line{dOS+34}='if keyCode(spaceBar)';
line{dOS+35}='onBreak=false;';
line{dOS+36}='elseif keyCode(escapeKey)';
line{dOS+37}='clear all;';
line{dOS+38}='sca';
line{dOS+39}='end';
line{dOS+40}='end';

tabLine=[dOS+33:dOS+34 dOS+36 dOS+39];
dTabLine=[dOS+35 dOS+37:dOS+38];

studyInfo.fLine.iTrial = line{1}(10:end);

fName = 'instructionTrial';
fID = fopen([studyInfo.path filesep fName '.m'],'w');
for i=1:length(line)
    if any(ismember(i,tabLine))
        fprintf(fID,'\t%s\n',line{i});
    elseif any(ismember(i,dTabLine))
        fprintf(fID,'\t\t%s\n',line{i});
    else
        fprintf(fID,'%s\n',line{i});
    end
end
fclose(fID);
