function studyInfo=wCompSStimTrial(studyInfo)
%   function studyInfo=wCompSStimTrial(studyInfo)
%
%   This funtion generates the stimTrial script for Comparison Behavioral 
%   Rating Study experiments. 
%
% (c) Duc T. Nguyen and Blair Kaneshiro, 2017
% Distributed under Creative Commons Zero (CC0) license
% Contact: audexpcreator@gmail.com

stimNStruct=studyInfo.stimNStruct;

line{1}='function stimTrial(wPtr, wRect, bgColor, fontColor, pahandle, wavdata, freq, i, k)';
line{2}=sprintf('%% %s', line{1});
line{3}='% This function displays the stim screen with stim identifier and plays the stimulus.'; 
dLines=3;
line{dLines+1}='%';
line{dLines+2}='% This script was generated by AudExpCreator.';
line{dLines+3}='% (c) Duc T. Nguyen and Blair Kaneshiro, 2017';
line{dLines+4}='% Distributed under Creative Commons Zero (CC0) license';
line{dLines+5}='% Contact: audexpcreator@gmail.com';
dOS=5;

line{dOS+5}='PsychPortAudio(''FillBuffer'', pahandle, wavdata{i,k});';
line{dOS+6}='KbName(''UnifyKeyNames'');';

line{dOS+8}='[~, yC] = RectCenter(wRect);';
line{dOS+9}='duration =(length(wavdata{i,k})/freq{i,k}) + .5;';

line{dOS+11}='if k==1';
line{dOS+12}=sprintf('sText=''%s'';',stimNStruct.stimAText);
line{dOS+13}='elseif k==2';
line{dOS+14}=sprintf('sText=''%s'';',stimNStruct.stimBText);
line{dOS+15}='end';
tabLine=[dOS+12 dOS+14];

line{dOS+17}='Screen(''FillRect'',wPtr,bgColor);';
line{dOS+18}='Screen(''TextSize'', wPtr, 20);';
line{dOS+19}='[~, ~, ~] = DrawFormattedText(wPtr, sText, ''center'', yC-80, fontColor);';

line{dOS+21}='Screen(''TextSize'', wPtr, 45);';
line{dOS+22}='mytext = ''LISTEN'';';
line{dOS+23}='[~, ~, ~] = DrawFormattedText(wPtr, mytext, ''center'', ''center'', fontColor);';

line{dOS+25}='Screen(''Flip'', wPtr);';
line{dOS+26}='HideCursor;';

line{dOS+28}='tic';
line{dOS+29}='while toc<1';
line{dOS+30}='end';

line{dOS+32}='PsychPortAudio(''Start'', pahandle, 1, 0, 0);';
line{dOS+33}='tic';
line{dOS+34}='while toc < duration';
line{dOS+35}='[~, ~, keyCode] = KbCheck;';
line{dOS+36}='if keyCode(KbName(''Escape''))';
line{dOS+37}='sca;';
line{dOS+38}='clear all;';
line{dOS+39}='end';
line{dOS+40}='end';
tabLine=[tabLine dOS+35:dOS+36 dOS+39];
dTabLine=dOS+37:dOS+38;

line{dOS+42}='Screen (''Close'');';


studyInfo.fLine.sTrial = line{1}(10:end);

fName = 'stimTrial';
fID = fopen([studyInfo.path filesep fName '.m'],'w');
for i=1:length(line)
    if any(ismember(i,tabLine))
        fprintf(fID,'\t%s\n',line{i});
    elseif any(ismember(i,dTabLine))
        fprintf(fID,'\t\t%s\n',line{i});
    else
        fprintf(fID,'%s\n',line{i});
    end
end
fclose(fID);




